## Лабораторная работа 9
### Тасклеты и очереди работ

> 1. **Тасклеты** — это механизм обработки нижних половин, построенный на основе механизма отложенных прерываний.
>
> 2. Тасклет от начала до конца должен быть выполнен.
>
> 3. **Несколько объектов, связанных с очередью работ (workqueue), представлены в ядре соответствующими структурами:**
>     - Работа (work);
> 	- Очередь работ (workqueue) – коллекция work. Workqueue и work относятся как один-ко-многим;
>     - Рабочий (worker). Worker соответствует потоку ядра worker_thread;
>     - Пул рабочих потоков (worker_pool) это – набор рабочих (worker). Worker_pool и worker относятся как «один ко многим»;
>     - Pwd (pool_workqueue) это – посредник, который отвечает за отношение workqueue и worker_pool: workqueue и pwd является отношением один-ко-многим, а pwd и worker_pool отношение один-к-одному.
>
> 4. **Отличия тасклета и очереди задач:**
> 	1. тасклет выполняется в контексте прерывания(нельзя заблокировать), очередь в контексте процесса(можно заблокировать)
> 	2. такслет выполняется на процессоре, на котором был выполнен обработчик прерывания, очередь нет
> 	3. такслет выполняется вскоре после обработчика прерывания, очередь нет
>
> 5. **Состояния тасклета:**
> 	- 0 - до планирования
> 	- 1 - планирование
> 	- 2 - выполнение
> 	Тасклет может быть запланирован сколько угодно раз, выполнен один раз.
>
> 6. **Что такое линия irq - СВЯТОЕ**
> 	- Выделенная линия irq - эта та линия, на которую конкретное устройство посылает сигнал прерываний. Она выделяется конкретному устройству и по этой линии устройство посылает сигнал прерывания на контроллер прерывания.
> 	
> 7. **Покажите, что разделяются линии irq**
> 	- IRQF_SHARED - разрешает разделение irq несколькими устройствами	
> 	- cat /proc/interrupts
> 	
> 8. **Какие действия вы выполняете в вашем обработчике аппаратного прерывания**
> 	- Тасклеты - планируется тасклет, выводится информация о состоянии тасклета
> 	- Очереди работ - ворки добавляются в очередь работ
> 	
> 9. **Сколько у вас workов**
> 	- 2
> 	
> 10. **Что делают ваши work**
> 	- первый просто блокируется, выводит до и после блокировки
> 	- второй обрабатывает нажатие клавиши, выводит, какая клавиша нажата
>
> shedule - планирует выполнение аппартного прерывания
>
> 11. **Какие действия нужно выполнить, чтобы ваши workи в итоге выполнились**
> 	- Создать очередь работ, инициализировать work'и, добавить work'и в очередь работ
> 	
>
> покажите код вашего обработчика аппаратного прерывания
>
> 12. **Что вы сделали чтобы зарегистрировать в системе свой обработчик аппаратного прерывания и обработчик какого прерывания**
> 	- request_irq(KEYB_IRQ, (irq_handler_t)irq_handler, IRQF_SHARED, "keyboard", (void *)(irq_handler));
> 	  - Параметры: номер линии irq, имя функции обработчика, флаг разделения линии, имя прерывания, адрес обработчика прерывания.
> 	- Обработчик прерывания клавиатуры
> 	
> 13. **Когда будет выполнен ваш тасклет и на каком процессоре** 
> 	- по завершению обработчика аппаратного прерывания, на процессоре, на котором был выполнен обработчик прерывания
> 	
> 14. **В чем особенность обработчиков аппаратных прерываний**
> 	- Аппаратные прерывания выполняются при всех запрещённых прерываниях на данном процессоре и при запрете прерывания на других процессорах по данной линии IRQ
> 	
> 15. **Как организовать взаимоисключение на тасклетах (при учёте, что их нельзя блокировать)?**
> 	- Тасклеты не могут блокироваться, но в них могут использоваться спинлоки. И на тасклетах могут быть определены соответствующие спинлоки.
> 	
>
> По наличию этого флага очереди (workqueue) делятся на привязанные (normal) и непривязанные (unbound). В привязанных очередях work’и при добавлении привязываются к текущему CPU, то есть в таких очередях work’и исполняются на том ядре, которое его планирует (на котором выполнялся обработчик прерывания). В непривязанных очередях work’и могут исполняться на любом ядре.
>
> 16. **Что такое файл?**
> 	- Файл - это любая поименованная совокупность данных, хранящаяся во вторичной памяти.